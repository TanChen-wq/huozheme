# 启动说明

## 快速启动

### 1. 确保环境已安装
```bash
node --version  # 应该 >= 14.0.0
npm --version   # 应该 >= 6.0.0
```

### 2. 安装依赖（如果还未安装）
```bash
cd huozheme
npm install
```

### 3. 启动服务器
```bash
npm start
```

看到以下输出表示启动成功：
```
数据库表初始化完成
服务器运行在 http://localhost:3000
数据库初始化完成
定时任务已启动
数据库连接成功
```

### 4. 访问应用
打开浏览器访问：**http://localhost:3000**

## 使用流程

### 第一步：注册账号
1. 在首页点击"立即注册"
2. 填写用户名、邮箱、密码（手机号可选）
3. 点击"注册"按钮
4. 注册成功后会自动跳转到登录表单

### 第二步：登录
1. 输入注册时使用的邮箱和密码
2. 点击"登录"按钮
3. 登录成功后会跳转到个人面板

### 第三步：添加联系人
1. 在导航栏点击"联系人"
2. 填写联系人姓名、邮箱或手机号
3. 点击"添加联系人"
4. 联系人会在你签到时收到通知

### 第四步：每日签到
1. 在导航栏点击"签到"
2. 选择今天的状态（很好/还行/有点累/需要联系）
3. 可选：输入一句话留言
4. 点击"签到"按钮
5. 系统会自动通知你的所有联系人

### 第五步：查看统计
1. 在导航栏点击"统计"
2. 查看连续签到天数、累计签到次数
3. 查看最近 7 天的签到趋势图

## 通知系统说明

### 演示模式（默认）
- 邮件和短信通知只会在服务器控制台打印
- 不会真实发送邮件或短信
- 适合测试和演示

### 生产模式
如需启用真实邮件发送：

1. **配置邮箱**
   编辑 `config/email.js` 文件，填写你的 SMTP 配置

2. **启用发送**
   编辑 `server/notification.js` 文件，找到 `sendEmailNotification` 函数，取消以下代码的注释：
   ```javascript
   const info = await transporter.sendMail({
     from: '"活着么" <your-email@example.com>',
     to: to,
     subject: subject,
     html: html
   });
   return info;
   ```

3. **重启服务器**
   ```bash
   # 按 Ctrl+C 停止服务器
   npm start
   ```

## 定时任务说明

服务器启动后会自动运行定时任务：

- **执行频率**：每小时一次
- **检查内容**：查找超过 24 小时未签到的用户
- **执行动作**：向这些用户的联系人发送提醒通知

查看定时任务日志：
```
执行定时任务：检查未签到用户
发现未签到用户: 用户名 (邮箱)
定时任务完成，共处理 N 个用户
```

## 数据库说明

- **类型**：SQLite
- **文件位置**：`data.db`（首次启动时自动创建）
- **表结构**：
  - `users` - 用户表
  - `checkins` - 签到记录表
  - `contacts` - 联系人表
  - `notifications` - 通知记录表

### 重置数据库
如需重置所有数据：
```bash
# 停止服务器（Ctrl+C）
rm data.db
npm start
```

## 常见问题

### Q1: 端口 3000 被占用怎么办？
修改 `server/index.js` 文件中的端口号：
```javascript
const PORT = process.env.PORT || 3001; // 改为其他端口
```

或者在启动时指定端口：
```bash
PORT=3001 npm start
```

### Q2: 如何停止服务器？
在终端按 `Ctrl + C`

### Q3: 如何查看服务器日志？
所有日志会直接输出到终端，包括：
- 数据库操作日志
- API 请求日志
- 通知发送日志
- 定时任务日志

### Q4: 忘记密码怎么办？
目前版本暂不支持密码重置，可以通过以下方式解决：
1. 使用其他邮箱重新注册
2. 或者直接删除 `data.db` 文件重置数据库

### Q5: 可以同时注册多个账号吗？
可以，只要使用不同的邮箱地址即可。

### Q6: 一天可以签到多次吗？
不可以，每个用户每天只能签到一次。如果已经签到，会显示"今天已经签到过了"的提示。

### Q7: 如何修改已签到的状态？
当前版本不支持修改已签到的状态，请在签到前仔细选择。

### Q8: 联系人会收到什么通知？
联系人会收到两种通知：
1. **签到通知**：当你签到时，会收到你的状态和留言
2. **未签到提醒**：当你超过 24 小时未签到时，会收到提醒

## 开发模式

如果需要修改代码并自动重启服务器：

1. **安装 nodemon**
```bash
npm install -g nodemon
```

2. **使用开发模式启动**
```bash
npm run dev
```

3. **修改代码**
保存文件后，服务器会自动重启

## 部署到生产环境

### 使用 PM2（推荐）
```bash
# 安装 PM2
npm install -g pm2

# 启动应用
pm2 start server/index.js --name huozheme

# 查看状态
pm2 status

# 查看日志
pm2 logs huozheme

# 停止应用
pm2 stop huozheme

# 重启应用
pm2 restart huozheme
```

### 使用 Docker
```dockerfile
FROM node:14
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

```bash
# 构建镜像
docker build -t huozheme .

# 运行容器
docker run -d -p 3000:3000 --name huozheme huozheme
```

## 性能优化建议

1. **使用 Redis 缓存**：缓存签到统计数据
2. **数据库索引**：为常用查询字段添加索引
3. **CDN 加速**：将静态资源托管到 CDN
4. **负载均衡**：使用 Nginx 进行负载均衡
5. **日志管理**：使用 Winston 或 Bunyan 管理日志

## 安全建议

1. **修改 JWT 密钥**：编辑 `server/auth.js` 中的 `JWT_SECRET`
2. **使用 HTTPS**：配置 SSL 证书
3. **限流保护**：使用 express-rate-limit 防止暴力破解
4. **输入验证**：使用 joi 或 express-validator 验证输入
5. **环境变量**：使用 dotenv 管理敏感配置

## 技术支持

如有问题，请查看：
- 项目文档：`README.md`
- 代码注释：所有核心文件都有详细注释
- 控制台日志：查看服务器输出的错误信息

---

**祝你使用愉快！** 🎉
